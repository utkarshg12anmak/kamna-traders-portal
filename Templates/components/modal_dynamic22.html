{# templates/components/modal_dynamic.html #}
<style>
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      align-items: center; justify-content: center; z-index:1000; }
  .modal-box     { background: white; width: {{ width|default:"600px" }}; max-height: {{ height|default:"80vh" }};
      display:flex; flex-direction:column; border-radius:8px; overflow:hidden; }
  .modal-header  { background: var(--modal-bg,#0077b6); color:#fff; padding:1rem; display:flex;
      justify-content:space-between; align-items:center; }
  .modal-body    { flex:1; padding:1rem; overflow-y:auto; }
  .modal-footer  { padding:1rem; border-top:1px solid #eee; text-align:right; }
  .btn-sm        { padding:0.5rem 1rem; border:none; border-radius:4px; cursor:pointer; }
  .btn-add       { background:#eee; margin-right:1rem; }
  .btn-save      { background: var(--modal-bg,#0077b6); color:#fff; }
  .brand-input   { display:flex; gap:0.5rem; margin-bottom:0.5rem; }
  .brand-input input { flex:1; padding:0.5rem; border:1px solid #ccc; border-radius:4px; }
</style>

<div id="{{ id }}" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">
      <h2 style="color: white !important;">{{ title|default:"Modal Title" }}</h2>
      <button onclick="closeModal('{{ id }}')" style="background:transparent;border:none;color:#fff;font-size:1.2rem;">&times;</button>
    </div>
    <div class="modal-body">
      <div id="{{ id }}-list">
        {# initial inputs if any #}
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-sm btn-add" onclick="addField('{{ id }}')">+ Add Brand</button>
      <button class="btn-sm btn-save" onclick="saveBrands('{{ id }}')">{{ save_text|default:"Save" }}</button>
    </div>
  </div>
</div>

<script>
  function openModal(id){ document.getElementById(id).style.display='flex'; }
  function closeModal(id){ document.getElementById(id).style.display='none'; }

  function addField(id){
    const container = document.getElementById(id+'-list');
    const idx = container.children.length;
    const wrapper = document.createElement('div');
    wrapper.className='brand-input';
    wrapper.innerHTML=`
      <input type="text" name="brand_${idx}" placeholder="Brand name ${idx+1}" />
      <button type="button" onclick="this.parentNode.remove()">Ã—</button>
    `;
    container.appendChild(wrapper);
  }

  function saveBrands(id){
    const container = document.getElementById(id+'-list');
    const inputs = container.querySelectorAll('input');
    const values = Array.from(inputs).map(i=>i.value.trim()).filter(v=>v);
    if(!values.length){ alert('Please add at least one brand'); return; }
    // Option A: AJAX POST (requires endpoint)
    /*
    fetch('{{ action_url }}', {
      method:'POST',
      headers:{ 'Content-Type':'application/json','X-CSRFToken':'{{ csrf_token }}' },
      body: JSON.stringify({ brands: values })
    }).then(r=>r.json()).then(data=>{ closeModal(id); /* refresh table */ });
    */
    // Option B: simple form POST
    const form = document.createElement('form');
    form.method='POST'; form.action='{{ action_url }}';
    form.innerHTML = `<input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" />`;
    values.forEach((v,i)=>{
      const inp = document.createElement('input');
      inp.name='brand_names'; inp.value=v;
      form.appendChild(inp);
    });
    document.body.appendChild(form);
    form.submit();
  }
</script>
