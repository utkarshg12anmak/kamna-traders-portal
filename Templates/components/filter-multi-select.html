
<style>
  .filter-dropdown {
    display: none;
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    padding: .5rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    z-index: 2000;
  }
  .filter-dropdown.active {
    display: block;
  }
  .filter-multiselect {
    width: 200px;
  }
</style>

<div class="filter-wrapper" style="position: relative; display: inline-block;">
  <button id="{{ button_id }}" type="button" class="btn-secondary">
    {{ button_text }} â–¾
  </button>

  <div id="{{ dropdown_id }}" class="filter-dropdown">
    <form id="{{ form_id }}" method="get" action="">
      <select id="{{ select_id }}"
              name="{{ field_name }}"
              class="filter-multiselect"
              multiple
              size="5">
        {% for opt in options %}
          <option value="{{ opt.id }}"
            {% if opt.id|stringformat:"s" in selected %}
              selected
            {% endif %}>
            {{ opt.name }}
          </option>
        {% endfor %}
      </select>
      <div style="margin-top:.5rem; text-align: right;">
        <button type="submit" class="btn-primary btn-sm">Filter</button>
        <button type="button"
                id="{{ button_id }}-reset"
                class="btn-secondary btn-sm">
          Reset
        </button>
      </div>
    </form>
  </div>
</div>

<script>
// Toggle dropdown
document.getElementById('{{ button_id }}').addEventListener('click', e => {
  e.stopPropagation();
  const dd = document.getElementById('{{ dropdown_id }}');
  dd.classList.toggle('active');
});

// Reset selections
document.getElementById('{{ button_id }}-reset').addEventListener('click', () => {
  document.getElementById('{{ select_id }}').selectedIndex = -1;
});

// Click outside closes dropdown
document.addEventListener('click', () => {
  const dd = document.getElementById('{{ dropdown_id }}');
  dd.classList.remove('active');
});

// Prevent clicks inside dropdown from closing it
document.getElementById('{{ dropdown_id }}')
  .addEventListener('click', e => e.stopPropagation());
</script>
